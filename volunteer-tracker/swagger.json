{
  "openapi": "3.0.0",
  "info": {
    "title": "Volunteer Tracking API",
    "version": "1.0.0",
    "description": "API for managing volunteers and opportunities with GitHub OAuth 2.0 authentication"
  },
  "servers": [
    {
      "url": "http://localhost:8080",
      "description": "Local development server"
    },
    {
      "url": "https://cse341-volunteer-tracker.onrender.com",
      "description": "Production server on Render"
    }
  ],
  "tags": [
    {
      "name": "default",
      "description": "Default API operations from default-controller"
    },
    {
      "name": "Volunteer Tracking API",
      "description": "Volunteer and opportunity management operations from volunteer-tracking-api-controller"
    },
    {
      "name": "Authentication",
      "description": "GitHub OAuth 2.0 authentication operations"
    }
  ],
  "components": {
    "securitySchemes": {
      "OAuth2": {
        "type": "oauth2",
        "flows": {
          "authorizationCode": {
            "authorizationUrl": "https://github.com/login/oauth/authorize",
            "tokenUrl": "https://github.com/login/oauth/access_token",
            "scopes": {
              "user:email": "Read user email"
            }
          }
        }
      }
    },
    "schemas": {
      "User": {
        "type": "object",
        "properties": {
          "id": { "type": "string", "description": "GitHub user ID" },
          "email": { "type": "string", "format": "email" },
          "name": { "type": "string" }
        },
        "required": ["id"]
      },
      "Opportunity": {
        "type": "object",
        "properties": {
          "_id": { "type": "string", "description": "MongoDB ObjectId of the opportunity" },
          "organizerId": { "type": "string", "description": "GitHub user ID of the organizer" },
          "title": { "type": "string" },
          "description": { "type": "string" },
          "location": { "type": "string" },
          "date": {
            "type": "string",
            "format": "date",
            "description": "ISO 8601 date string (e.g., YYYY-MM-DD)"
          },
          "time": {
            "type": "string",
            "pattern": "^([01]\\d|2[0-3]):[0-5]\\d$",
            "description": "Time in HH:MM 24-hour format"
          },
          "duration": {
            "type": "number",
            "minimum": 0,
            "description": "Duration in hours, must be non-negative"
          },
          "createdAt": { "type": "string", "format": "date-time" },
          "isDeleted": { "type": "boolean" },
          "deleteDate": { "type": "string", "format": "date-time", "nullable": true }
        },
        "required": ["_id", "organizerId", "title", "description", "location", "date", "time", "duration", "createdAt", "isDeleted"]
      },
      "OpportunityInput": {
        "type": "object",
        "properties": {
          "title": { "type": "string" },
          "description": { "type": "string" },
          "location": { "type": "string" },
          "date": {
            "type": "string",
            "format": "date",
            "description": "ISO 8601 date string (e.g., YYYY-MM-DD)"
          },
          "time": {
            "type": "string",
            "pattern": "^([01]\\d|2[0-3]):[0-5]\\d$",
            "description": "Time in HH:MM 24-hour format"
          },
          "duration": {
            "type": "number",
            "minimum": 0,
            "description": "Duration in hours, must be non-negative"
          }
        },
        "required": ["title", "description", "location", "date", "time", "duration"]
      },
      "UserOpportunity": {
        "type": "object",
        "properties": {
          "_id": { "type": "string", "description": "MongoDB ObjectId of the user-opportunity record" },
          "userId": { "type": "string", "description": "GitHub user ID" },
          "opportunityId": { "type": "string", "description": "MongoDB ObjectId of the opportunity" },
          "createdAt": { "type": "string", "format": "date-time" },
          "isDeleted": { "type": "boolean" },
          "deleteDate": { "type": "string", "format": "date-time", "nullable": true },
          "approvedBy": { "type": "string", "nullable": true, "description": "GitHub user ID of the approver" },
          "approvedOn": { "type": "string", "format": "date-time", "nullable": true }
        },
        "required": ["_id", "userId", "opportunityId", "createdAt", "isDeleted"]
      },
      "ErrorResponse": {
        "type": "object",
        "properties": {
          "message": { "type": "string", "example": "Error message" },
          "error": { "type": "string", "example": "Detailed error description" }
        },
        "required": ["message", "error"]
      }
    }
  },
  "paths": {
    "/": {
      "get": {
        "tags": ["default"],
        "summary": "Welcome message",
        "description": "Returns a welcome message indicating the Volunteer Tracker API is running and the database connection status.",
        "responses": {
          "200": {
            "description": "API is running and database is connected",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Volunteer Tracker API is running! - Database 'volunteer-db' connected and ready!"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/auth/github": {
      "get": {
        "tags": ["Authentication"],
        "summary": "Initiate GitHub OAuth login",
        "description": "Redirects to GitHub for OAuth 2.0 authentication.",
        "responses": {
          "302": {
            "description": "Redirects to GitHub authorization page"
          }
        }
      }
    },
    "/auth/github/callback": {
      "get": {
        "tags": ["Authentication"],
        "summary": "GitHub OAuth callback",
        "description": "Handles the callback from GitHub OAuth, authenticates the user, and redirects to Swagger UI.",
        "responses": {
          "302": {
            "description": "Redirects to /api-docs on success or /auth/login on failure"
          }
        }
      }
    },
    "/auth/login": {
      "get": {
        "tags": ["Authentication"],
        "summary": "Login page",
        "description": "Returns an unauthorized message prompting GitHub login.",
        "responses": {
          "401": {
            "description": "Unauthorized - Please log in via GitHub",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": { "type": "string", "example": "Unauthorized - Please log in via GitHub" }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/auth/logout": {
      "get": {
        "tags": ["Authentication"],
        "summary": "Logout",
        "description": "Logs out the current user by clearing the session and redirects to the login page.",
        "responses": {
          "302": {
            "description": "Redirects to /auth/login after logout"
          }
        }
      }
    },
    "/api/users": {
      "get": {
        "tags": ["Volunteer Tracking API"],
        "summary": "Get authenticated user",
        "description": "Returns the authenticated GitHub user's info.",
        "security": [{ "OAuth2": ["user:email"] }],
        "responses": {
          "200": {
            "description": "User info fetched",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": { "type": "string", "example": "User info fetched" },
                    "data": { "$ref": "#/components/schemas/User" }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - User not authenticated"
          }
        }
      },
      "post": {
        "tags": ["Volunteer Tracking API"],
        "summary": "Create user (placeholder)",
        "description": "Placeholder for creating a user; returns authenticated GitHub user info.",
        "security": [{ "OAuth2": ["user:email"] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/User" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "User info fetched",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": { "type": "string", "example": "User info fetched" },
                    "data": { "$ref": "#/components/schemas/User" }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - User not authenticated"
          },
          "422": {
            "description": "Invalid input",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      }
    },
    "/api/users/{id}": {
      "get": {
        "tags": ["Volunteer Tracking API"],
        "summary": "Get user by GitHub ID",
        "description": "Returns the authenticated GitHub user's info if the ID matches.",
        "security": [{ "OAuth2": ["user:email"] }],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": { "type": "string" },
            "description": "GitHub user ID"
          }
        ],
        "responses": {
          "200": {
            "description": "User fetched successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": { "type": "string", "example": "User fetched successfully" },
                    "data": { "$ref": "#/components/schemas/User" }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - User not authenticated"
          },
          "403": {
            "description": "Forbidden - Can only fetch own user data",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      },
      "put": {
        "tags": ["Volunteer Tracking API"],
        "summary": "Update user (placeholder)",
        "description": "Placeholder for updating user; returns authenticated GitHub user info if ID matches.",
        "security": [{ "OAuth2": ["user:email"] }],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": { "type": "string" },
            "description": "GitHub user ID"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/User" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "User info fetched",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": { "type": "string", "example": "User info fetched" },
                    "data": { "$ref": "#/components/schemas/User" }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - User not authenticated"
          },
          "403": {
            "description": "Forbidden - Can only update own user data",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "422": {
            "description": "Invalid input",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      },
      "delete": {
        "tags": ["Volunteer Tracking API"],
        "summary": "Delete user (placeholder)",
        "description": "Placeholder for deleting user; returns a message indicating no user data is stored.",
        "security": [{ "OAuth2": ["user:email"] }],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": { "type": "string" },
            "description": "GitHub user ID"
          }
        ],
        "responses": {
          "200": {
            "description": "User deletion not applicable",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": { "type": "string", "example": "User deletion not applicable" },
                    "data": { "type": "object", "example": { "message": "No user data stored" } }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - User not authenticated"
          },
          "403": {
            "description": "Forbidden - Can only delete own user data",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      }
    },
    "/api/opportunities": {
      "get": {
        "tags": ["Volunteer Tracking API"],
        "summary": "Get all opportunities",
        "description": "Retrieves a list of all opportunities (non-deleted).",
        "security": [{ "OAuth2": ["user:email"] }],
        "responses": {
          "200": {
            "description": "List of opportunities",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": { "type": "string", "example": "Opportunities fetched successfully" },
                    "data": {
                      "type": "array",
                      "items": { "$ref": "#/components/schemas/Opportunity" }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - User not authenticated"
          },
          "404": {
            "description": "No opportunities found",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      },
      "post": {
        "tags": ["Volunteer Tracking API"],
        "summary": "Create a new opportunity",
        "description": "Creates a new opportunity. Requires organizer role.",
        "security": [{ "OAuth2": ["user:email"] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/OpportunityInput" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Opportunity created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": { "type": "string", "example": "Opportunity created successfully" },
                    "data": { "$ref": "#/components/schemas/Opportunity" }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - User not authenticated"
          },
          "403": {
            "description": "Forbidden - Only organizers can create opportunities",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "422": {
            "description": "Invalid input",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      }
    },
    "/api/opportunities/{id}": {
      "get": {
        "tags": ["Volunteer Tracking API"],
        "summary": "Get opportunity by ID",
        "description": "Retrieves an opportunity by its ID.",
        "security": [{ "OAuth2": ["user:email"] }],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": { "type": "string", "pattern": "^[0-9a-fA-F]{24}$" },
            "description": "MongoDB ObjectId of the opportunity"
          }
        ],
        "responses": {
          "200": {
            "description": "Opportunity fetched successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": { "type": "string", "example": "Opportunity fetched successfully" },
                    "data": { "$ref": "#/components/schemas/Opportunity" }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - User not authenticated"
          },
          "422": {
            "description": "Invalid opportunity ID format",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "404": {
            "description": "Opportunity not found",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      },
      "put": {
        "tags": ["Volunteer Tracking API"],
        "summary": "Update opportunity by ID",
        "description": "Updates an opportunity's details. Requires organizer role.",
        "security": [{ "OAuth2": ["user:email"] }],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": { "type": "string", "pattern": "^[0-9a-fA-F]{24}$" },
            "description": "MongoDB ObjectId of the opportunity"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/OpportunityInput" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Opportunity updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": { "type": "string", "example": "Opportunity updated successfully" },
                    "data": {
                      "type": "object",
                      "properties": {
                        "matchedCount": { "type": "integer", "example": 1 },
                        "modifiedCount": { "type": "integer", "example": 1 }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - User not authenticated"
          },
          "403": {
            "description": "Forbidden - Only the organizer can update",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "422": {
            "description": "Invalid input or opportunity ID format",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "404": {
            "description": "Opportunity not found",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      },
      "delete": {
        "tags": ["Volunteer Tracking API"],
        "summary": "Delete opportunity by ID",
        "description": "Soft deletes an opportunity. Requires organizer role.",
        "security": [{ "OAuth2": ["user:email"] }],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": { "type": "string", "pattern": "^[0-9a-fA-F]{24}$" },
            "description": "MongoDB ObjectId of the opportunity"
          }
        ],
        "responses": {
          "200": {
            "description": "Opportunity deleted successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": { "type": "string", "example": "Opportunity deleted successfully" },
                    "data": {
                      "type": "object",
                      "properties": {
                        "matchedCount": { "type": "integer", "example": 1 },
                        "modifiedCount": { "type": "integer", "example": 1 }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - User not authenticated"
          },
          "403": {
            "description": "Forbidden - Only the organizer can delete",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "422": {
            "description": "Invalid opportunity ID format",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "404": {
            "description": "Opportunity not found",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      }
    },
    "/api/events/{userId}/opportunities": {
      "get": {
        "tags": ["Volunteer Tracking API"],
        "summary": "Get user opportunities",
        "description": "Retrieves opportunities signed up by a user.",
        "security": [{ "OAuth2": ["user:email"] }],
        "parameters": [
          {
            "in": "path",
            "name": "userId",
            "required": true,
            "schema": { "type": "string" },
            "description": "GitHub user ID"
          }
        ],
        "responses": {
          "200": {
            "description": "User opportunities fetched successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": { "type": "string", "example": "User opportunities fetched successfully" },
                    "data": {
                      "type": "array",
                      "items": { "$ref": "#/components/schemas/UserOpportunity" }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - User not authenticated"
          },
          "403": {
            "description": "Forbidden - Can only fetch own opportunities",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "404": {
            "description": "No opportunities found for user",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      }
    },
    "/api/events/{userId}/opportunities/{opportunityId}": {
      "post": {
        "tags": ["Volunteer Tracking API"],
        "summary": "Sign up for an opportunity",
        "description": "Signs a user up for an opportunity using their IDs.",
        "security": [{ "OAuth2": ["user:email"] }],
        "parameters": [
          {
            "in": "path",
            "name": "userId",
            "required": true,
            "schema": { "type": "string" },
            "description": "GitHub user ID"
          },
          {
            "in": "path",
            "name": "opportunityId",
            "required": true,
            "schema": { "type": "string", "pattern": "^[0-9a-fA-F]{24}$" },
            "description": "MongoDB ObjectId of the opportunity"
          }
        ],
        "responses": {
          "200": {
            "description": "Successfully signed up for opportunity",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": { "type": "string", "example": "Successfully signed up for opportunity" },
                    "data": { "$ref": "#/components/schemas/UserOpportunity" }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - User not authenticated"
          },
          "403": {
            "description": "Forbidden - Can only sign up self",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "422": {
            "description": "Invalid user ID or opportunity ID format",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      }
    },
    "/api/events/{userId}/opportunities/{userOpportunityId}": {
      "put": {
        "tags": ["Volunteer Tracking API"],
        "summary": "Approve volunteered hours",
        "description": "Approves volunteered hours for a user-opportunity record. Requires approver role.",
        "security": [{ "OAuth2": ["user:email"] }],
        "parameters": [
          {
            "in": "path",
            "name": "userId",
            "required": true,
            "schema": { "type": "string" },
            "description": "GitHub user ID"
          },
          {
            "in": "path",
            "name": "userOpportunityId",
            "required": true,
            "schema": { "type": "string", "pattern": "^[0-9a-fA-F]{24}$" },
            "description": "MongoDB ObjectId of the user-opportunity record"
          }
        ],
        "responses": {
          "200": {
            "description": "Successfully approved hours",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": { "type": "string", "example": "Successfully approved hours" },
                    "data": {
                      "type": "object",
                      "properties": {
                        "matchedCount": { "type": "integer", "example": 1 },
                        "modifiedCount": { "type": "integer", "example": 1 }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - User not authenticated"
          },
          "403": {
            "description": "Forbidden - Only approvers can approve hours",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "422": {
            "description": "Invalid user ID or user opportunity ID format",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "404": {
            "description": "User-opportunity record not found",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      }
    },
    "/api/events/{userOpportunityId}": {
      "delete": {
        "tags": ["Volunteer Tracking API"],
        "summary": "Withdraw from an opportunity",
        "description": "Soft deletes a user-opportunity record by its ID.",
        "security": [{ "OAuth2": ["user:email"] }],
        "parameters": [
          {
            "in": "path",
            "name": "userOpportunityId",
            "required": true,
            "schema": { "type": "string", "pattern": "^[0-9a-fA-F]{24}$" },
            "description": "MongoDB ObjectId of the user-opportunity record"
          }
        ],
        "responses": {
          "200": {
            "description": "Successfully withdrew from opportunity",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": { "type": "string", "example": "Successfully withdrew from opportunity" },
                    "data": {
                      "type": "object",
                      "properties": {
                        "matchedCount": { "type": "integer", "example": 1 },
                        "modifiedCount": { "type": "integer", "example": 1 }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - User not authenticated"
          },
          "403": {
            "description": "Forbidden - Can only withdraw self",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "422": {
            "description": "Invalid userOpportunityId format",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "404": {
            "description": "User-opportunity record not found",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      }
    }
  }
}